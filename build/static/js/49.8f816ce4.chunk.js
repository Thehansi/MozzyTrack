/*! For license information please see 49.8f816ce4.chunk.js.LICENSE.txt */
(this["webpackJsonpdatta-able-rv18.0.4"]=this["webpackJsonpdatta-able-rv18.0.4"]||[]).push([[49],{452:function(e,t,a){"use strict";var r=a(30),n=a(11),i=a(12),o=a(16),c=a(17),s=a(37),u=a.n(s),l=a(895),d=a(860),p=a(473),m=(a(457),a(367)),h=a(455),f=function(e){Object(o.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(n.a)(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={isOption:e.props.isOption,fullCard:!1,collapseCard:!1,loadCard:!1,cardRemove:!1},e.cardReloadHandler=function(){e.setState({loadCard:!0}),setInterval((function(){e.setState({loadCard:!1})}),3e3)},e.cardRemoveHandler=function(){e.setState({cardRemove:!0})},e}return Object(i.a)(a,[{key:"render",value:function(){var e,t,a,n,i,o=this,c=[];return this.state.isOption&&(a=u.a.createElement("div",{className:"card-header-right"},u.a.createElement(l.a,{alignRight:!0,className:"btn-group card-option"},u.a.createElement(l.a.Toggle,{id:"dropdown-basic",className:"btn-icon"},u.a.createElement("i",{className:"feather icon-more-horizontal"})),u.a.createElement(l.a.Menu,{as:"ul",className:"list-unstyled card-option"},u.a.createElement(l.a.Item,{as:"li",className:"dropdown-item",onClick:function(){o.setState((function(e){return{fullCard:!e.fullCard}}))}},u.a.createElement("i",{className:this.state.fullCard?"feather icon-minimize":"feather icon-maximize"}),u.a.createElement("a",{href:h.a.BLANK_LINK}," ",this.state.fullCard?"Restore":"Maximize"," ")),u.a.createElement(l.a.Item,{as:"li",className:"dropdown-item",onClick:function(){o.setState((function(e){return{collapseCard:!e.collapseCard}}))}},u.a.createElement("i",{className:this.state.collapseCard?"feather icon-plus":"feather icon-minus"}),u.a.createElement("a",{href:h.a.BLANK_LINK}," ",this.state.collapseCard?"Expand":"Collapse"," ")),u.a.createElement(l.a.Item,{as:"li",className:"dropdown-item",onClick:this.cardReloadHandler},u.a.createElement("i",{className:"feather icon-refresh-cw"}),u.a.createElement("a",{href:h.a.BLANK_LINK}," Reload ")),u.a.createElement(l.a.Item,{as:"li",className:"dropdown-item",onClick:this.cardRemoveHandler},u.a.createElement("i",{className:"feather icon-trash"}),u.a.createElement("a",{href:h.a.BLANK_LINK}," Remove ")))))),n=u.a.createElement(d.a.Header,null,u.a.createElement(d.a.Title,{as:"h5"},this.props.title),a),this.state.fullCard&&(c=[].concat(Object(r.a)(c),["full-card"]),e={position:"fixed",top:0,left:0,right:0,width:this.props.windowWidth,height:this.props.windowHeight}),this.state.loadCard&&(c=[].concat(Object(r.a)(c),["card-load"]),t=u.a.createElement("div",{className:"card-loader"},u.a.createElement("i",{className:"pct-loader1 anim-rotate"}))),this.state.cardRemove&&(c=[].concat(Object(r.a)(c),["d-none"])),this.props.cardClass&&(c=[].concat(Object(r.a)(c),[this.props.cardClass])),i=u.a.createElement(d.a,{className:c.join(" "),style:e},n,u.a.createElement(p.a,{in:!this.state.collapseCard},u.a.createElement("div",null,u.a.createElement(d.a.Body,{style:{backgroundColor:"rgb(185, 210, 214)"}},this.props.children))),t),u.a.createElement(m.a,null,i)}}]),a}(s.Component);t.a=f},867:function(e,t,a){"use strict";a.r(t);var r=a(30),n=a(108),i=a(456),o=a(49),c=a(37),s=a.n(c),u=(a(367),a(483)),l=a.n(u),d=a(370),p=(a(373),a(376),a(452)),m=a(897),h=a(482),f=a(672),b=a(460),v=a.n(b),x=a(104),y=a(369),E=a(368),R=a.n(E),g=a(271);function P(){P=function(){return t};var e,t={},a=Object.prototype,r=a.hasOwnProperty,n=Object.defineProperty||function(e,t,a){e[t]=a.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,a){return e[t]=a}}function l(e,t,a,r){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),c=new N(r||[]);return n(o,"_invoke",{value:j(e,a,c)}),o}function d(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",m="executing",h="completed",f={};function b(){}function v(){}function x(){}var y={};u(y,o,(function(){return this}));var E=Object.getPrototypeOf,R=E&&E(E(A([])));R&&R!==a&&r.call(R,o)&&(y=R);var g=x.prototype=b.prototype=Object.create(y);function O(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function a(n,i,o,c){var s=d(e[n],e,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return a("throw",e,o,c)}))}c(s.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function j(t,a,r){var n=p;return function(i,o){if(n===m)throw new Error("Generator is already running");if(n===h){if("throw"===i)throw o;return{value:e,done:!0}}for(r.method=i,r.arg=o;;){var c=r.delegate;if(c){var s=q(c,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=m;var u=d(t,a,r);if("normal"===u.type){if(n=r.done?h:"suspendedYield",u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=h,r.method="throw",r.arg=u.arg)}}}function q(t,a){var r=a.method,n=t.iterator[r];if(n===e)return a.delegate=null,"throw"===r&&t.iterator.return&&(a.method="return",a.arg=e,q(t,a),"throw"===a.method)||"return"!==r&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var i=d(n,t.iterator,a.arg);if("throw"===i.type)return a.method="throw",a.arg=i.arg,a.delegate=null,f;var o=i.arg;return o?o.done?(a[t.resultName]=o.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,f):o:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,f)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function A(t){if(t||""===t){var a=t[o];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function a(){for(;++n<t.length;)if(r.call(t,n))return a.value=t[n],a.done=!1,a;return a.value=e,a.done=!0,a};return i.next=i}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=x,n(g,"constructor",{value:x,configurable:!0}),n(x,"constructor",{value:v,configurable:!0}),v.displayName=u(x,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},t.awrap=function(e){return{__await:e}},O(T.prototype),u(T.prototype,c,(function(){return this})),t.AsyncIterator=T,t.async=function(e,a,r,n,i){void 0===i&&(i=Promise);var o=new T(l(e,a,r,n),i);return t.isGeneratorFunction(a)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},O(g),u(g,s,"Generator"),u(g,o,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),a=[];for(var r in t)a.push(r);return a.reverse(),function e(){for(;a.length;){var r=a.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var a in this)"t"===a.charAt(0)&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function n(r,n){return c.type="throw",c.arg=t,a.next=r,n&&(a.method="next",a.arg=e),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],c=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),C(a),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var a=this.tryEntries[t];if(a.tryLoc===e){var r=a.completion;if("throw"===r.type){var n=r.arg;C(a)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,r){return this.delegate={iterator:A(t),resultName:a,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}t.default=function(){var e,t,a,u,b,E,O,T,j,q,D,C,N,A,I,S,F=Object(c.useRef)(null),H=Object(c.useState)(0),w=Object(o.a)(H,2),U=w[0],k=w[1],G=Object(c.useState)([]),L=Object(o.a)(G,2),B=L[0],V=L[1],Q=Object(c.useState)([]),M=Object(o.a)(Q,2),W=M[0],_=M[1],K=Object(c.useState)([]),Y=Object(o.a)(K,2),z=Y[0],J=Y[1],$=Object(c.useState)([]),X=Object(o.a)($,2),Z=X[0],ee=X[1],te=Object(c.useState)([]),ae=Object(o.a)(te,2),re=ae[0],ne=ae[1],ie=Object(c.useState)([]),oe=Object(o.a)(ie,2),ce=oe[0],se=oe[1],ue=Object(c.useState)(""),le=Object(o.a)(ue,2),de=(le[0],le[1],Object(c.useState)([])),pe=Object(o.a)(de,2),me=(pe[0],pe[1]),he=Object(c.useState)({currencyRate:null}),fe=Object(o.a)(he,2),be=fe[0],ve=fe[1],xe=Object(c.useState)(0),ye=Object(o.a)(xe,2),Ee=(ye[0],ye[1]),Re=Object(c.useState)([]),ge=Object(o.a)(Re,2),Pe=ge[0],Oe=ge[1],Te=Object(c.useState)(0),je=Object(o.a)(Te,2),qe=je[0],De=je[1],Ce=Object(c.useState)(0),Ne=Object(o.a)(Ce,2),Ae=Ne[0],Ie=Ne[1],Se=Object(c.useState)(0),Fe=Object(o.a)(Se,2),He=Fe[0],we=Fe[1],Ue=Object(c.useState)([]),ke=Object(o.a)(Ue,2),Ge=ke[0],Le=ke[1],Be=Object(c.useState)(100),Ve=Object(o.a)(Be,2),Qe=Ve[0],Me=(Ve[1],Object(c.useState)([])),We=Object(o.a)(Me,2),_e=(We[0],We[1],Object(c.useState)([])),Ke=Object(o.a)(_e,2),Ye=Ke[0],ze=Ke[1],Je=Object(c.useState)([]),$e=Object(o.a)(Je,2),Xe=$e[0],Ze=$e[1],et=Object(c.useState)([]),tt=Object(o.a)(et,2),at=tt[0],rt=tt[1],nt=Object(c.useState)({isLoad:!1}),it=Object(o.a)(nt,2),ot=it[0],ct=it[1],st=Object(c.useState)({index:null}),ut=Object(o.a)(st,2),lt=ut[0],dt=ut[1],pt=Object(c.useState)({}),mt=Object(o.a)(pt,2),ht=(mt[0],mt[1]),ft=Object(c.useState)(0),bt=Object(o.a)(ft,2),vt=bt[0],xt=bt[1],yt=Object(c.useState)(!1),Et=Object(o.a)(yt,2),Rt=Et[0],gt=Et[1],Pt=Object(c.useState)(!1),Ot=Object(o.a)(Pt,2),Tt=Ot[0],jt=Ot[1],qt=Object(c.useState)(!1),Dt=Object(o.a)(qt,2),Ct=(Dt[0],Dt[1]),Nt=Object(c.useState)(!0),At=Object(o.a)(Nt,2),It=(At[0],At[1]),St=Object(c.useState)(!0),Ft=Object(o.a)(St,2),Ht=(Ft[0],Ft[1]),wt=Object(c.useState)({File:{}}),Ut=Object(o.a)(wt,2),kt=Ut[0],Gt=Ut[1],Lt=Object(c.useState)({PurchaseRequisitionAttachmentsAddGrid:[]}),Bt=Object(o.a)(Lt,2),Vt=Bt[0],Qt=Bt[1],Mt=Object(c.useState)({GroupTable:{}}),Wt=Object(o.a)(Mt,2),_t=Wt[0],Kt=Wt[1],Yt=Object(c.useState)({AttachGroup:{}}),zt=Object(o.a)(Yt,2),Jt=zt[0],$t=zt[1],Xt=Object(c.useState)(!1),Zt=Object(o.a)(Xt,2),ea=Zt[0],ta=Zt[1],aa=Object(c.useState)(!1),ra=Object(o.a)(aa,2),na=ra[0],ia=ra[1],oa=Object(c.useState)(!0),ca=Object(o.a)(oa,2),sa=ca[0],ua=ca[1],la=Object(c.useState)(!0),da=Object(o.a)(la,2),pa=da[0],ma=da[1],ha=Object(c.useState)(!0),fa=Object(o.a)(ha,2),ba=fa[0],va=fa[1],xa=Object(c.useState)(!0),ya=Object(o.a)(xa,2),Ea=ya[0],Ra=ya[1],ga=Object(c.useState)(!0),Pa=Object(o.a)(ga,2),Oa=Pa[0],Ta=Pa[1],ja=Object(c.useState)([]),qa=Object(o.a)(ja,2),Da=(qa[0],qa[1]),Ca=Object(c.useState)({}),Na=Object(o.a)(Ca,2),Aa=Na[0],Ia=Na[1],Sa=Object(c.useState)([]),Fa=Object(o.a)(Sa,2),Ha=Fa[0],wa=Fa[1],Ua=Object(c.useState)({PurchaseRequisitionItems:[]}),ka=Object(o.a)(Ua,2),Ga=ka[0],La=ka[1],Ba=[{ID:"Y",Name:"Inventry Item"},{ID:"N",Name:"Service Item"}],Va=Object(c.useState)([]),Qa=Object(o.a)(Va,2),Ma=(Qa[0],Qa[1],0),Wa=Object(c.useRef)(null),_a=Object(c.useState)({jUser:{},PurchaseRequisitionHeader:{},jApprovalTemplateHeader:{},DocumentID:3e3,UploadAttchment:!1,Choose:[{ID:!0,Name:"Replace"},{ID:!1,Name:"New"}],Status:[{ID:"0",Name:"Pending"},{ID:"1",Name:"Cancel"},{ID:"2",Name:"Approve"},{ID:"3",Name:"Reject"},{ID:"4",Name:"Hold"}],sapPost:[{ID:!0,Name:"Yes"},{ID:!1,Name:"No"}],validStatus:[{ID:0,Name:"Expired"},{ID:1,Name:"Valid"}]}),Ka=Object(o.a)(_a,2),Ya=Ka[0],za=Ka[1],Ja=Object(c.useState)({Status:[{ID:"0",Name:"Pending"},{ID:"1",Name:"Cancel"},{ID:"2",Name:"Approve"},{ID:"3",Name:"Reject"},{ID:"4",Name:"Hold"}]}),$a=Object(o.a)(Ja,2),Xa=$a[0],Za=($a[1],Object(c.useState)({Status:[{ID:!0,Name:"Yes"},{ID:!1,Name:"No"}]})),er=Object(o.a)(Za,2),tr=er[0],ar=(er[1],Object(c.useState)({validStatus:[{ID:0,Name:"Expired"},{ID:1,Name:"Valid"}]})),rr=Object(o.a)(ar,2),nr=rr[0],ir=(rr[1],Object(x.h)()),or=Object(x.g)(),cr=Object(c.useState)(!1),sr=Object(o.a)(cr,2),ur=sr[0],lr=sr[1],dr={txt:"text/plain",html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",xml:"application/xml",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};Object(c.useEffect)((function(){ir.state&&ir.state.isPD&&!ur?(pr(),lr(!0)):pr()}),[]);F.current&&F.current.instance;var pr=function(){return(e=e||Object(i.a)(P().mark((function e(){var t,a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(localStorage.getItem("user")),e.next=3,R.a.get("/api/CheckUserAuthentication",{params:{UsersID:t.UserName,MenuID:1400}});case 3:if(a=e.sent,Ia(t.UserName),0==a.data.length){e.next=14;break}return e.next=8,R.a.get("/api/getUserGroup",{params:{UserName:t.UserName}});case 8:if(e.sent,a.data[0].UserView){va(!1);try{R.a.all([R.a.get("/api/getPRTypes"),R.a.get("/api/getItemType"),R.a.get("/api/getWarehouses"),R.a.get("/api/getUOM"),R.a.get("/api/getApprovalLevel"),R.a.get("/api/getCurrency"),R.a.get("/api/number-series-lookup-by-module",{params:{DocumentID:Ya.DocumentID}}),R.a.get("/api/getValidityPeriod"),R.a.get("/api/getBranch"),R.a.get("/api/getDepartment"),R.a.get("/api/getPMOfficer"),R.a.get("/api/getAllPR",{params:{EnterUser:t.UserName}}),R.a.get("/api/getLoginUserDetails",{params:{UserName:t.UserName}})]).then(R.a.spread((function(e,a,r,i,o,c,s,u,l,d,p,m,h){V(e.data),_(a.data),ne(r.data),ee(o.data),se(c.data),me("LKR"),ze(d.data),Ze(l.data),rt(p.data),ct({isLoad:!1}),wa(h.data);var f=m.data;Oe(f);var b=new Date,v=b.setDate(b.getDate()+parseInt(u.data.ValidityPeriod)),x=new Date(v);za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{CreatedDate:new Date,ValidFrom:new Date,ValidityPeriod:u.data.ValidityPeriod,ValidTo:x,CurrencyCode:"LKR",Date:new Date,ApproveDate:new Date,PRUser:t.UserName,ApproveUser:t.UserName,TotalAmount:0,TotalCost:0,RequestorName:t.UserName,RequestorsDepartment:h.data[0].Department,RequestorsBranch:h.data[0].Branch,RequestorEmail:h.data[0].Email,Requestorcontanctno:h.data[0].ContactNo,ValidityStatus:1,ExpectedDate:new Date,ApproveStatus:"0"})}})),Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{UnitCost:0,UnitPrice:0,RequiredDate:new Date,TotalAmountExclusive:0})}})),ir.state.isPD&&mr()}))).catch((function(e){return console.error(e)}))}catch(r){console.error("Error fetching details:",r)}}a.data[0].UserAdd&&ua(!1),a.data[0].UserEdit&&ma(!1),a.data[0].UserHold&&Ra(!1),a.data[0].UserCancel&&Ta(!1);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)},mr=function(e){return(t=t||Object(i.a)(P().mark((function e(t){var a,r,i,o,c,s,u,l,d,p;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return It(!1),ia(!0),e.next=4,R.a.get("/api/getPRHeaders",{params:{PRNumber:ir.state.data.PRNumber}});case 4:return a=e.sent,e.next=7,R.a.get("/api/getPRItems",{params:{PRHeaderID:ir.state.data.PRHeaderID}});case 7:return r=e.sent,e.next=10,R.a.get("/api/getPRAttachment",{params:{PRHeaderID:ir.state.data.PRHeaderID}});case 10:return i=e.sent,e.next=13,R.a.get("/api/getPMOfficer");case 13:return o=e.sent,c=r.data,c.map((function(e){return e.TotalAmountExclusive=e.Quantity*e.UnitPrice,e.TotalCostExclusive=e.Quantity*e.UnitCost,e})),rt(o.data),Ee(ir.state.rowIndex),xt(ir.state.data.PRHeaderID),Qt({PurchaseRequisitionAttachmentsAddGrid:i.data}),za({PurchaseRequisitionHeader:a.data[0]}),La({PurchaseRequisitionItems:r.data}),void 0!=ir.state.data.ValidTo&&void 0!=ir.state.data.ApproveStatus&&(s=gr(new Date(ir.state.data.ValidTo)),u=gr(new Date),s<u&&0==ir.state.data.ApproveStatus&&za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ValidityStatus:0})}}))),l=JSON.parse(localStorage.getItem("user")),e.next=26,R.a.get("/api/getUserGroup",{params:{UserName:l.UserName}});case 26:if(d=e.sent,void 0==ir.state.data.ApproveStatus&&2!=ir.state.data.ApproveStatus){e.next=35;break}if(0==d.data.length){e.next=32;break}return e.next=31,R.a.get("/api/getNextPriority",{params:{PRHeaderID:ir.state.data.PRNumber,UserGroup:d.data[0].UserGroup}});case 31:p=e.sent;case 32:0!=p.data.length?(za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:"2"})}})),gt(!0),ua(!0)):4!=ir.state.data.ApproveStatus&&0!=ir.state.data.ApproveStatus&&2!=ir.state.data.ApproveStatus?(ua(!0),gt(!0),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:ir.state.data.ApproveStatus})}}))):(ua(!1),gt(!1),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:ir.state.data.ApproveStatus})}}))),e.next=38;break;case 35:ua(!1),gt(!1),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:ir.state.data.ApproveStatus})}}));case 38:za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{PRUser:l.UserName,ApproveUser:l.UserName})}})),or.replace({state:null}),ia(!1);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)},hr=function(){return(a=a||Object(i.a)(P().mark((function e(){var t,a,r,n;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.get("/api/getValidityPeriod");case 2:t=e.sent,a=new Date,r=a.setDate(a.getDate()+parseInt(t.data.ValidityPeriod)),n=new Date(r),Kt((function(){return{GroupTable:{}}})),$t((function(){return{AttachGroup:{}}})),Qt((function(){return{PurchaseRequisitionAttachmentsAddGrid:[]}})),xt(0),k(0),gt(!1),La({PurchaseRequisitionItems:[]}),Ht(!0),za((function(){return{jUser:{},GroupTable:{},PurchaseRequisitionHeader:{CreatedDate:new Date,ValidFrom:new Date,ValidityPeriod:t.data.ValidityPeriod,ValidTo:n,CurrencyCode:"LKR",Date:new Date,ApproveDate:new Date,PRUser:Aa,ApproveUser:Aa,TotalAmount:0,FileNo:null,TotalCost:0,RequestorName:Aa,RequestorsDepartment:Ha[0].Department,RequestorsBranch:Ha[0].Branch,RequestorEmail:Ha[0].Email,Requestorcontanctno:Ha[0].ContactNo,ValidityStatus:1,ExpectedDate:new Date,ApproveStatus:"0"},jApprovalTemplateHeader:{},PurchaseRequisitionItems:[],PurchaseRequisitionAttachments:[],AttachGroup:{}}})),Wa.current&&Wa.current.instance.reset(),ua(!1),Da([]);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)},fr=function(e,t){Object(g.a)({message:e,type:t,displayTime:3e3,position:{at:"top right",offset:"50"}})},br=function(){return(u=u||Object(i.a)(P().mark((function e(){return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!=Ya.PurchaseRequisitionHeader.PRType&&NaN!=Ya.PurchaseRequisitionHeader.PRType&&void 0!=Ya.PurchaseRequisitionHeader.PRType){e.next=5;break}return fr("PR Type is Required","error"),e.abrupt("return",!1);case 5:if(""!=Ya.PurchaseRequisitionHeader.ItemCategory&&NaN!=Ya.PurchaseRequisitionHeader.ItemCategory&&void 0!=Ya.PurchaseRequisitionHeader.ItemCategory){e.next=10;break}return fr("Item Type is Required","error"),e.abrupt("return",!1);case 10:if(0!=Ga.PurchaseRequisitionItems.length&&NaN!=Ga.PurchaseRequisitionItems&&void 0!=Ga.PurchaseRequisitionItems){e.next=15;break}return fr("Unable to save without Item Details","error"),e.abrupt("return",!1);case 15:if(""!=Ya.PurchaseRequisitionHeader.RequestorsDepartment&&NaN!=Ya.PurchaseRequisitionHeader.RequestorsDepartment&&void 0!=Ya.PurchaseRequisitionHeader.RequestorsDepartment){e.next=20;break}return fr("Requestors Department is Required","error"),e.abrupt("return",!1);case 20:if(""!=Ya.PurchaseRequisitionHeader.RequestorName&&NaN!=Ya.PurchaseRequisitionHeader.RequestorName&&void 0!=Ya.PurchaseRequisitionHeader.RequestorName){e.next=25;break}return fr("Requestors Name is Required","error"),e.abrupt("return",!1);case 25:if(""!=Ya.PurchaseRequisitionHeader.RequestorsBranch&&NaN!=Ya.PurchaseRequisitionHeader.RequestorsBranch&&void 0!=Ya.PurchaseRequisitionHeader.RequestorsBranch){e.next=30;break}return fr("Requestors Branch is Required","error"),e.abrupt("return",!1);case 30:if(""!=Ya.PurchaseRequisitionHeader.ApproveLevel&&NaN!=Ya.PurchaseRequisitionHeader.ApproveLevel&&void 0!=Ya.PurchaseRequisitionHeader.ApproveLevel||"2"!==U){e.next=35;break}return fr("Approval Level is Required","error"),e.abrupt("return",!1);case 35:if(""!=Ya.PurchaseRequisitionHeader.ExpectedDate&&NaN!=Ya.PurchaseRequisitionHeader.ExpectedDate&&void 0!=Ya.PurchaseRequisitionHeader.ExpectedDate){e.next=40;break}return fr("Expected Delivery Date is Required","error"),e.abrupt("return",!1);case 40:if(!Oa||1!=Ya.PurchaseRequisitionHeader.ApproveStatus){e.next=45;break}return fr("You Don't have permission to Cancel Approval","error"),e.abrupt("return",!1);case 45:if(!Ea||4!=Ya.PurchaseRequisitionHeader.ApproveStatus){e.next=48;break}return fr("You Don't have permission to Hold Approval","error"),e.abrupt("return",!1);case 48:if(2!=Ya.PurchaseRequisitionHeader.ApproveStatus){e.next=54;break}return e.next=51,vr();case 51:return e.abrupt("return",e.sent);case 54:return e.abrupt("return",!0);case 55:case"end":return e.stop()}}),e)})))).apply(this,arguments)},vr=function(){return(b=b||Object(i.a)(P().mark((function e(){var t,a,r,n,i,o,c,s;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=-1,a=-1,r=gr(new Date(Ya.PurchaseRequisitionHeader.ExpectedDate)),n=gr(new Date),0,e.next=7,R.a.get("/api/getSelectedUserID",{params:{UserName:Aa}});case 7:if(void 0==(i=e.sent)&&NaN==i&&""==i||i.data[0].UsersID,void 0==Ya.PurchaseRequisitionHeader.ApproveLevel){e.next=14;break}return e.next=12,R.a.get("/api/checkApprovalName",{params:{UserName:Aa,ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel,PRType:Ya.PurchaseRequisitionHeader.PRType}});case 12:o=e.sent,a=o.data.length;case 14:return e.next=16,R.a.get("/api/checkItemCategory",{params:{PRType:Ya.PurchaseRequisitionHeader.PRType,ItemType:Ya.PurchaseRequisitionHeader.ItemCategory}});case 16:return c=e.sent,e.next=19,R.a.get("/api/checkPRType",{params:{PRType:Ya.PurchaseRequisitionHeader.PRType,UserName:Aa}});case 19:if(s=e.sent,0!=a){e.next=25;break}return fr("You Don't have permission to this Approval Level","error"),e.abrupt("return",!1);case 25:if(0!=s.data.length){e.next=30;break}return fr("You Don't have permission to PR Type","error"),e.abrupt("return",!1);case 30:if(0!=c.data.length){e.next=35;break}return fr("You Don't have permission to Item Type","error"),e.abrupt("return",!1);case 35:if(0!=t){e.next=40;break}return fr("You Don't have permission to add total","error"),e.abrupt("return",!1);case 40:if(!(r<n)){e.next=45;break}return fr("Invalid Delivery Date","error"),e.abrupt("return",!1);case 45:if(2!=Ya.PurchaseRequisitionHeader.ApproveStatus||void 0!=Ya.PurchaseRequisitionHeader.ApproveLevel){e.next=48;break}return fr("Please Select the Approval Leval","error"),e.abrupt("return",!1);case 48:if(void 0==Ya.PurchaseRequisitionHeader.ApproveLevel){e.next=54;break}return e.next=51,xr();case 51:return e.abrupt("return",e.sent);case 54:return e.abrupt("return",!0);case 55:case"end":return e.stop()}}),e)})))).apply(this,arguments)},xr=function(){return(E=E||Object(i.a)(P().mark((function e(){var t,a,r,n,i,o;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1,0,t=!1,a=!1,r=!1,n=!1,0==Ya.PurchaseRequisitionHeader.ApproveStatus){e.next=36;break}return e.next=9,R.a.get("/api/checkLimite",{params:{UserName:Aa,ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel,PRType:Ya.PurchaseRequisitionHeader.PRType,ItemCategory:Ya.PurchaseRequisitionHeader.ItemCategory}});case 9:if(i=e.sent,i.data.length,null!=i.data[0].DecreaseQty&&(r=i.data[0].DecreaseQty),null!=i.data[0].IncreaseQty&&(n=i.data[0].IncreaseQty),void 0==Ya.PurchaseRequisitionHeader.PRNumber){e.next=18;break}return e.next=16,R.a.get("/api/getAllQTY",{params:{PRNumber:Ya.PurchaseRequisitionHeader.PRNumber}});case 16:0!=(o=e.sent).data.length&&(o.data[0].TotalQty,o.data.forEach((function(e){var r=parseFloat(e.Quantity),n=e.ItemCode;Ga.PurchaseRequisitionItems.forEach((function(e){var i=parseFloat(e.Quantity),o=e.ItemCode;if(o===n){if(r<i)return t=!0,o,!1;if(r>i)return a=!0,o,!1}}))})));case 18:if(!(i.data[0].MaxValue<Ya.PurchaseRequisitionHeader.TotalAmount)){e.next=23;break}return fr("Total amount is grater than maximum limits","error"),e.abrupt("return",!1);case 23:if(!(i.data[0].MinValue>Ya.PurchaseRequisitionHeader.TotalAmount)){e.next=28;break}return fr("Total amount is less than minimum limits ","error"),e.abrupt("return",!1);case 28:if(n||!t){e.next=33;break}return fr("Need Permision to Increase Quantity ","error"),e.abrupt("return",!1);case 33:if(r||!a){e.next=36;break}return fr("Need Permision to Decrees Quantity ","error"),e.abrupt("return",!1);case 36:return e.abrupt("return",!0);case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)},yr=function(){return(T=T||Object(i.a)(P().mark((function e(){var t,a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=void 0==Ya.PurchaseRequisitionHeader.PRNumber?Ma:Ya.PurchaseRequisitionHeader.PRNumber,R.a.post("/api/PurchesRequest-sync",{PurchaseRequisitionHeader:Ya.PurchaseRequisitionHeader,PurchaseRequisitionAttachments:Vt.PurchaseRequisitionAttachmentsAddGrid,PurchaseRequisitionItems:Ga.PurchaseRequisitionItems,PR_Number:a}).then((function(e){return(t=t||Object(i.a)(P().mark((function e(t){return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.error){e.next=11;break}return e.next=3,R.a.post("/api/updateIsSapPost",{params:{PRNumber:a,IsSapPost:!0}});case 3:return e.sent,e.next=6,R.a.post("/api/updateStatus",{params:{PRNumber:a,Status:"2"}});case 6:e.sent,xt(0),hr(),e.next=18;break;case 11:return e.next=13,R.a.post("/api/updateIsSapPost",{params:{PRNumber:a,IsSapPost:!1}});case 13:return e.sent,e.next=16,R.a.post("/api/updateStatus",{params:{PRNumber:a,Status:"0"}});case 16:e.sent,v.a.fire({icon:"error",title:'<span style="color: red;">SAP Error!</span>',text:t.data.message.error.message.value,confirmButtonColor:"#d33",confirmButtonText:"OK"});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)})).catch((function(e){v.a.fire({icon:"error",title:'<span style="color: red;">Error!</span>',text:"Failed to save purchase request details",confirmButtonColor:"#d33",confirmButtonText:"OK"}),console.log(e),console.error("Error:",e)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)},Er=function(){return(j=j||Object(i.a)(P().mark((function e(){return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0==Ya.PurchaseRequisitionHeader.ApproveLevel){e.next=4;break}return e.next=3,R.a.get("/api/checkLimite",{params:{UserName:Aa,ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel,PRType:Ya.PurchaseRequisitionHeader.PRType,ItemCategory:Ya.PurchaseRequisitionHeader.ItemCategory}});case 3:e.sent;case 4:if(""!=_t.GroupTable.Module&&NaN!=_t.GroupTable.Module&&void 0!=_t.GroupTable.Module){e.next=9;break}return fr("Module is Required","error"),e.abrupt("return",!1);case 9:if(""!=_t.GroupTable.ItemCode&&NaN!=_t.GroupTable.ItemCode&&void 0!=_t.GroupTable.ItemCode){e.next=14;break}return fr("Item/Service Code is Required","error"),e.abrupt("return",!1);case 14:if(""!=_t.GroupTable.UnitPrice&&NaN!=_t.GroupTable.UnitPrice&&void 0!=_t.GroupTable.UnitPrice){e.next=19;break}return fr("UnitPrice is Required","error"),e.abrupt("return",!1);case 19:if(""!=_t.GroupTable.Quantity&&NaN!=_t.GroupTable.Quantity&&void 0!=_t.GroupTable.Quantity){e.next=24;break}return fr("Quantity is Required","error"),e.abrupt("return",!1);case 24:if(!(_t.GroupTable.Quantity<=0)){e.next=29;break}return fr("Quantity is greater than 0","error"),e.abrupt("return",!1);case 29:if(!(_t.GroupTable.UnitPrice<=0)){e.next=32;break}return fr("UnitPrice is greater than 0","error"),e.abrupt("return",!1);case 32:return e.abrupt("return",!0);case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)},Rr=Object(c.useCallback)((function(){if(F.current){var e=F.current.instance.getEditor("ExpectedDate");e&&e.focus()}}),[]),gr=function(e){var t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(a,"/").concat(r,"/").concat(t)},Pr=function(e){return dr[e]||"application/octet-stream"};return s.a.createElement("div",null,s.a.createElement(p.a,{title:"Purchase Requisition Entry"},s.a.createElement(m.a,{defaultActiveKey:"Header",id:"receipt-option"},s.a.createElement(d.f,{eventKey:"Header",title:"Header"},s.a.createElement(d.g,{ref:F,formData:Ya.PurchaseRequisitionHeader},s.a.createElement(d.b,{caption:"Header Details",colCount:2},s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"PRType",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,dataSource:B,valueExpr:"PRTypeCode",displayExpr:"Discription",onValueChanged:function(e){return(S=S||Object(i.a)(P().mark((function e(t){var a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ee([]),e.next=3,R.a.get("/api/filterApprovalLevelDetails",{params:{TransactionType:t.value}});case 3:a=e.sent,za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApprovalDescription:null,ApproveLevel:null})}})),0!=a.data.length&&ee(a.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}},s.a.createElement(d.d,{text:"PR Type"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"PRNumber",editorOptions:{maxLength:50,readOnly:!0}},s.a.createElement(d.d,{text:"PR Number"})),s.a.createElement(d.c,{dataField:"ExpectedDate",editorType:"dxDateBox"},s.a.createElement(d.d,{text:"Expected Delivery Date"})),s.a.createElement(d.c,{dataField:"FileNo",editorOptions:{maxLength:50,readOnly:!0}},s.a.createElement(d.d,{text:"File No"})),s.a.createElement(d.c,{dataField:"ValidityPeriod",editorType:"dxNumberBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Validity Period (Days)"})),s.a.createElement(d.c,{dataField:"ValidTo",editorType:"dxDateBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Valid To"})),s.a.createElement(d.c,{dataField:"CurrencyCode",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,dataSource:ce,valueExpr:"CurrCode",displayExpr:"DocCurrCod",onValueChanged:function(e){"LKR"==e.value?ve({currencyRate:1}):R.a.get("/api/getCurrencyRate",{params:{currencyCode:e.value}}).then((function(e){if(console.log(e.data[0].Rate),void 0==e.data[0].Rate||0==e.data[0].Rate)return fr("Currency rate for today not found. Please create it in SAP.","error"),!1;ve({currencyRate:e.data[0].Rate});var t=_t.GroupTable.UnitPrice;t>0&&Kt((function(a){return{GroupTable:Object(n.a)(Object(n.a)({},a.GroupTable),{},{UnitPriceWithForeignRate:t*e.data[0].Rate})}}))})).catch((function(e){console.log(e)}))}}},s.a.createElement(d.e,{message:"Field required"}),s.a.createElement(d.d,{text:"Currency Code"}))),s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"ItemCategory",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,dataSource:W,valueExpr:"FldValue",displayExpr:"FldValue",onValueChanged:function(e){void 0!=_t.GroupTable.Module&&R.a.get("/api/getItems",{params:{ItemType:e.value,module:_t.GroupTable.Module}}).then((function(e){Le(e.data)})).catch((function(e){console.log(e)}))}}},s.a.createElement(d.d,{text:"Item Type"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"CreatedDate",editorType:"dxDateBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"PR Created Date"})),s.a.createElement(d.c,{dataField:"ProcurementOfficer",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,dataSource:at,valueExpr:"OfficerID",displayExpr:"OfficerID",onValueChanged:function(e){if(!na){Ya.PurchaseRequisitionHeader.FileNo;var t=new Date;void 0!=e.value&&(jt(!0),za((function(a){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},a.PurchaseRequisitionHeader),{},{LastFileName:"",FileNo:t.getFullYear()+"\\"+e.value+"\\"})}})))}}}},s.a.createElement(d.d,{text:"Procurement Officer"})),s.a.createElement(d.c,{dataField:"LastFileName",editorOptions:{visible:Tt,onValueChanged:function(e){var t=Ya.PurchaseRequisitionHeader.FileNo;null!=t&&void 0!=e.value&&(jt(!0),za((function(a){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},a.PurchaseRequisitionHeader),{},{FileNo:t.substring(0,12)+e.value})}})))}}},s.a.createElement(d.d,{text:"File Name"})),s.a.createElement(d.c,{dataField:"ValidFrom",editorType:"dxDateBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Valid From"})),s.a.createElement(d.c,{dataField:"ValidityStatus",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,dataSource:Ya.validStatus,valueExpr:"ID",displayExpr:"Name",readOnly:!0}},s.a.createElement(d.d,{text:"Validity Status"})),s.a.createElement(d.c,{dataField:"ExchangeRate",editorType:"dxNumberBox",editorOptions:{value:be.currencyRate,readOnly:!0,format:"#,##0.00"}},s.a.createElement(d.d,{text:"Currency Rate"})))),s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"Remarks2",editorType:"dxTextArea"},s.a.createElement(d.d,{text:"Purchase Justification"})),s.a.createElement(d.c,{dataField:"Remarks1",editorType:"dxTextArea"},s.a.createElement(d.d,{text:"Remarks"}))))),s.a.createElement(d.f,{eventKey:"Items",title:"Items"},s.a.createElement(d.g,{formData:_t.GroupTable},s.a.createElement(d.b,{caption:"Item Details",colCount:2},s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"Module",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,items:Ba,valueExpr:"ID",displayExpr:"Name",onValueChanged:function(e){ot.isLoad||R.a.get("/api/getItems",{params:{ItemType:Ya.PurchaseRequisitionHeader.ItemCategory,module:e.value}}).then((function(e){Le(e.data),Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{ItemCode:null,ItemDescription:"",OnhandQty:null,WarehouseCode:null,UoMCode:null})}}))})).catch((function(e){console.log(e)}))}}},s.a.createElement(d.d,{text:"Module"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"ItemDescription",editorOptions:{maxLength:50}},s.a.createElement(d.d,{text:"Inventry/Service Description"})),s.a.createElement(d.c,{dataField:"OnhandQty",editorType:"dxNumberBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Quantity On Hand"})),s.a.createElement(d.c,{dataField:"UnitPriceWithForeignRate",editorType:"dxNumberBox",editorOptions:{format:"#,##0.00",readOnly:!0}}),s.a.createElement(d.c,{dataField:"TotalAmountExclusive",editorType:"dxNumberBox",editorOptions:{format:"#,##0.00",readOnly:!0}},s.a.createElement(d.d,{text:"Total Amount Exclusive"})),s.a.createElement(d.c,{dataField:"TotalCostExclusive",editorType:"dxNumberBox",editorOptions:{format:"#,##0.00",readOnly:!0}},s.a.createElement(d.d,{text:"Total Cost Exclusive"})),s.a.createElement(d.c,{dataField:"RequiredDate",editorType:"dxDateBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Required Date"}))),s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"ItemCode",editorType:"dxSelectBox",editorOptions:{items:Object(r.a)(Ge.slice(0,Qe)),valueExpr:"ItemCode",displayExpr:"ItemDesc",searchEnabled:!0,showClearButton:!0,onValueChanged:function(e){if(!ot.isLoad)if("see_more"===e.value)Kt({GroupTable:{ItemCode:null,ItemDescription:"",OnhandQty:null,WarehouseCode:null,UoMCode:null}});else try{if(null!=e.value){var t,a=null;R.a.all([R.a.get("/api/getItemDetails",{params:{ItemCode:e.value}}),R.a.get("/api/getItemPrice",{params:{ItemCode:e.value}}),R.a.get("/api/getUgpEntry",{params:{ItemCode:e.value}}),R.a.get("/api/getWHS",{params:{ItemCode:e.value}})]).then(R.a.spread((function(r,o,c,s){return(t=t||Object(i.a)(P().mark((function t(r,i,o,c){var s,u,l;return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0,s=0,u="01",console.log("whsCode",c),0==c.data.length){t.next=11;break}return u=c.data[0].WhsCode,t.next=8,R.a.get("/api/getAVGPrice",{params:{WhsCode:c.data[0].WhsCode,ItemCode:e.value}});case 8:l=t.sent,console.log("AVGPrice",l),0!=l.data.length&&(s=l.data[0].AVGPrice);case 11:if(0==o.data.length){t.next=16;break}return t.next=14,R.a.get("/api/getUomGroup",{params:{UgpEntry:o.data[0].UgpEntry}});case 14:a=t.sent,J(a.data);case 16:0!=i.data.length&&i.data[0].Price,Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{ItemDescription:r.data[0].ItemDesc,OnhandQty:r.data[0].QtyOnHand,WarehouseCode:u,UoMCode:a.data[0].cUnitCode,UnitCost:s,UnitPrice:0,Quantity:1,RequiredDate:new Date,TotalAmountExclusive:0})}})),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)({},e.PurchaseRequisitionHeader)}})),ht(1);case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}))).catch((function(e){return console.error(e)}))}else Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{ItemCode:null,ItemDescription:"",OnhandQty:null,WarehouseCode:null,UoMCode:null,UnitCost:0,UnitPrice:0})}}))}catch(r){console.error("Error fetching details:",r)}}}},s.a.createElement(d.d,{text:"Inventry/Service Code"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"UnitCost",editorType:"dxNumberBox",editorOptions:{format:"#,##0.00",onValueChanged:function(e){var t=_t.GroupTable.Quantity;e.value>0&&t>0?Kt((function(a){return{GroupTable:Object(n.a)(Object(n.a)({},a.GroupTable),{},{TotalCostExclusive:e.value*t})}})):Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{TotalCostExclusive:0})}}))}}},s.a.createElement(d.d,{text:"Unit Cost"})),s.a.createElement(d.c,{dataField:"UnitPrice",editorType:"dxNumberBox",editorOptions:{format:"#,##0.00",onValueChanged:function(e){var t=_t.GroupTable.Quantity;e.value>0&&t>0?Kt((function(a){return{GroupTable:Object(n.a)(Object(n.a)({},a.GroupTable),{},{TotalAmountExclusive:e.value*t,UnitPriceWithForeignRate:e.value*Ya.PurchaseRequisitionHeader.ExchangeRate})}})):Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{TotalAmountExclusive:0,UnitPriceWithForeignRate:0})}}))}}},s.a.createElement(d.d,{text:"Unit Price"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"Quantity",editorType:"dxNumberBox",editorOptions:{onValueChanged:function(e){if(!ot.isLoad){var t=_t.GroupTable.UnitPrice,a=_t.GroupTable.UnitCost;e.value>=0&&(t>0||a>0)?Kt((function(r){return{GroupTable:Object(n.a)(Object(n.a)({},r.GroupTable),{},{TotalAmountExclusive:e.value*t,TotalCostExclusive:e.value*a})}})):Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{TotalAmountExclusive:0,TotalCostExclusive:0})}}))}}}},s.a.createElement(d.d,{text:"Quantity",editorType:"dxNumberBox"}),s.a.createElement(d.e,{message:"Field required"})),s.a.createElement(d.c,{dataField:"WarehouseCode",editorType:"dxSelectBox",style:{backgroundColor:"red"},editorOptions:{searchEnabled:!0,items:re,valueExpr:"WhseCode",displayExpr:"WhseName",onValueChanged:function(e){try{var t;if(!ot.isLoad)R.a.all([R.a.get("/api/getAVGPrice",{params:{WhsCode:e.value,ItemCode:_t.GroupTable.ItemCode}})]).then(R.a.spread((function(e){return(t=t||Object(i.a)(P().mark((function e(t){var a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,0!=t.data.length&&(a=t.data[0].AVGPrice),Kt((function(e){return{GroupTable:Object(n.a)(Object(n.a)({},e.GroupTable),{},{UnitCost:a})}})),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)({},e.PurchaseRequisitionHeader)}}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}))).catch((function(e){return console.error(e)}))}catch(a){console.error("Error fetching details:",a)}}}},s.a.createElement(d.d,{text:"Warehouse"})),s.a.createElement(d.c,{dataField:"UoMCode",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,showClearButton:!0,items:z,valueExpr:"cUnitCode",displayExpr:"cUnitDescription"}},s.a.createElement(d.d,{text:"Unit Of Measure"})),s.a.createElement(d.c,{dataField:"IsReplacement",editorType:"dxRadioGroup",editorOptions:{items:Ya.Choose,valueExpr:"ID",displayExpr:"Name",layout:"horizontal"}},s.a.createElement(d.d,{visible:!1})))),s.a.createElement(d.b,null,s.a.createElement(d.c,{dataField:"Remark",editorType:"dxTextArea"},s.a.createElement(d.d,{text:"Remark"})))),s.a.createElement("br",null),s.a.createElement(h.a,{bg:"light",variant:"light"},s.a.createElement(f.a,{variant:"secondary",icon:"feather icon-layers",onClick:function(){return(q=q||Object(i.a)(P().mark((function e(){var t,a,i,o,c,s,u,l,d,p,m,h,f,b,v,x;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ot.isLoad){e.next=11;break}return e.next=3,Er();case 3:if(!e.sent){e.next=9;break}t=Object(r.a)(Ga.PurchaseRequisitionItems),a=_t.GroupTable.ItemCode,i=t.findIndex((function(e){return e.ItemCode===a})),console.log(ea),console.log("ccc",i),ea&&-1!==i?(t[i]=_t.GroupTable,o=_t.GroupTable.Quantity*_t.GroupTable.UnitPrice,c=_t.GroupTable.Quantity*_t.GroupTable.UnitCost,u=(s=qe)*Ae,l=s*He,za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{TotalAmount:parseFloat(e.PurchaseRequisitionHeader.TotalAmount)+o-u,TotalCost:parseFloat(e.PurchaseRequisitionHeader.TotalCost)+c-l})}})),La({PurchaseRequisitionItems:t}),Kt({GroupTable:{}}),ta(!1)):ea||-1!==i?fr("Already Added Item Code","error"):(t.push(_t.GroupTable),d=_t.GroupTable.Quantity*_t.GroupTable.UnitPrice,p=_t.GroupTable.Quantity*_t.GroupTable.UnitCost,za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{TotalAmount:parseFloat(e.PurchaseRequisitionHeader.TotalAmount)+d,TotalCost:parseFloat(e.PurchaseRequisitionHeader.TotalCost)+p})}})),La({PurchaseRequisitionItems:t}),Kt({GroupTable:{}}));case 9:e.next=27;break;case 11:return console.log("AWA AA"),e.next=14,Er();case 14:if(!e.sent){e.next=27;break}(m=Object(r.a)(Ga.PurchaseRequisitionItems))[lt.index]=_t.GroupTable,h=_t.GroupTable.Quantity*_t.GroupTable.UnitPrice,f=_t.GroupTable.Quantity*_t.GroupTable.UnitCost,v=(b=qe)*Ae,x=b*He,za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{TotalAmount:parseFloat(e.PurchaseRequisitionHeader.TotalAmount)+h-v,TotalCost:parseFloat(e.PurchaseRequisitionHeader.TotalCost)+f-x})}})),La({PurchaseRequisitionItems:m}),Kt({GroupTable:{}});case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)},disabled:sa},"Add")),s.a.createElement("br",null),s.a.createElement(y.k,{id:"Items",allowColumnReordering:!0,showBorders:!0,dataSource:Ga.PurchaseRequisitionItems,onCellDblClick:function(e){return(C=C||Object(i.a)(P().mark((function e(t){var a,r;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pa){e.next=19;break}return null,ct({isLoad:!0}),ta(!0),e.next=6,R.a.get("/api/getUgpEntry",{params:{ItemCode:t.data.ItemCode}});case 6:if(0==(a=e.sent).data.length){e.next=12;break}return e.next=10,R.a.get("/api/getUomGroup",{params:{UgpEntry:a.data[0].UgpEntry}});case 10:r=e.sent,J(r.data);case 12:dt({index:t.rowIndex}),R.a.get("/api/getItems",{params:{ItemType:Ya.PurchaseRequisitionHeader.ItemCategory,module:t.data.Module}}).then((function(e){Le(e.data)})).catch((function(e){console.log(e)})),De(t.data.Quantity),Ie(t.data.UnitPrice),we(t.data.UnitCost),Kt({GroupTable:{Module:t.data.Module,ItemCode:t.data.ItemCode,ItemDescription:t.data.ItemDescription,OnhandQty:t.data.OnhandQty,WarehouseCode:t.data.WarehouseCode,UoMCode:t.data.UoMCode,UnitCost:t.data.UnitCost,TotalCost:t.data.TotalCost,UnitPrice:t.data.UnitPrice,TotalAmountExclusive:t.data.TotalAmountExclusive,TotalCostExclusive:t.data.TotalCostExclusive,RequiredDate:t.data.RequiredDate,IsReplacement:t.data.IsReplacement,Remark:t.data.Remark,Quantity:t.data.Quantity}}),ct({isLoad:!1});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)},onRowRemoving:function(e){return(N=N||Object(i.a)(P().mark((function e(t){var a,r;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.data),void 0!=t.data.UnitPrice&&void 0!=t.data.UnitPrice&&void 0!=t.data.UnitCost&&(a=parseFloat(t.data.Quantity*t.data.UnitPrice),r=parseFloat(t.data.Quantity*t.data.UnitCost),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{TotalAmount:parseFloat(e.PurchaseRequisitionHeader.TotalAmount)-a,TotalCost:parseFloat(e.PurchaseRequisitionHeader.TotalCost)-r})}}))),void 0==t.data.PRHeaderID){e.next=6;break}return e.next=5,R.a.delete("/api/deleteRow",{params:{ItemCode:t.data.ItemCode,PRHeaderID:t.data.PRHeaderID}});case 5:e.sent;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},hoverStateEnabled:!0,allowColumnResizing:!0},s.a.createElement(y.h,{enabled:!0}),s.a.createElement(y.b,{mode:"row",allowDeleting:!0}),s.a.createElement(y.a,{dataField:"Module"},s.a.createElement(y.g,{items:Ba,valueExpr:"ID",displayExpr:"Name"})),s.a.createElement(y.a,{dataField:"PRHeaderID",visible:!1}),s.a.createElement(y.a,{dataField:"ItemCode",caption:"Item Code"}),s.a.createElement(y.a,{dataField:"ItemDescription",caption:"Item Description"}),s.a.createElement(y.a,{dataField:"WarehouseCode",caption:"Warehouse"}),s.a.createElement(y.a,{dataField:"UoMCode",caption:"Unit Of Measure"}),s.a.createElement(y.a,{dataField:"Quantity",dataType:"number",format:"#,##0.00",caption:"Quantity"}),s.a.createElement(y.a,{dataField:"UnitCost",dataType:"number",format:"#,##0.00"}),s.a.createElement(y.a,{dataField:"UnitPrice",dataType:"number",format:"#,##0.00"}),s.a.createElement(y.a,{dataField:"TotalAmountExclusive",dataType:"number",format:"#,##0.00"}),s.a.createElement(y.a,{dataField:"TotalCostExclusive",dataType:"number",format:"#,##0.00"}),s.a.createElement(y.a,{dataField:"RequiredDate",editorType:"dxDateBox"}),s.a.createElement(y.a,{dataField:"IsReplacement"},s.a.createElement(y.g,{items:[{ID:!0,Name:"Yes"},{ID:!1,Name:"No"}],valueExpr:"ID",displayExpr:"Name"})),s.a.createElement(y.a,{dataField:"Remark"}))),s.a.createElement(d.f,{eventKey:"Requestor",title:"Requestor"},s.a.createElement(d.g,{formData:Ya.PurchaseRequisitionHeader},s.a.createElement(d.b,{caption:"Requestor Details",colCount:2},s.a.createElement(d.c,{dataField:"RequestorName",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Requestor Name"})),s.a.createElement(d.c,{dataField:"RequestorsDepartment",editorType:"dxSelectBox",editorOptions:{dataSource:Ye,valueExpr:"DepartmentCode",displayExpr:"Discription",readOnly:!0}},s.a.createElement(d.d,{text:"Requestor's Department"})),s.a.createElement(d.c,{dataField:"RequestorsBranch",editorType:"dxSelectBox",editorOptions:{dataSource:Xe,valueExpr:"BranchCode",displayExpr:"Discription",readOnly:!0}},s.a.createElement(d.d,{text:"Requestor's Branch"})),s.a.createElement(d.c,{dataField:"RequestorEmail",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Requestor Email"})),s.a.createElement(d.c,{dataField:"Requestorcontanctno",editorType:"dxNumberBox",editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Requestor Contact No"})),s.a.createElement(d.c,{dataField:"OtherDetails",editorType:"dxTextArea"},s.a.createElement(d.d,{text:"Other Details"}))))),s.a.createElement(d.f,{eventKey:"Attachments",title:"Attachments"},s.a.createElement(d.g,{formData:Jt.AttachGroup},s.a.createElement(d.b,{caption:"Attachments"},s.a.createElement(d.c,{dataField:"Attach",editorType:"dxCheckBox",style:{marginRight:"10px"}},s.a.createElement(d.d,{text:"Attach"})),s.a.createElement(d.c,null,s.a.createElement("br",null),s.a.createElement("div",null,s.a.createElement("input",{type:"file",name:"file",id:"fileInput",onChange:function(e){return function(e){var t;t=e.target.files[0],Gt({File:t})}(e)}})),s.a.createElement("br",null)),s.a.createElement(d.c,{dataField:"Remarks",editorType:"dxTextArea"},s.a.createElement(d.d,{text:"Remarks"})))),s.a.createElement(h.a,{bg:"light",variant:"light"},s.a.createElement(f.a,{variant:"secondary",icon:"feather icon-layers",onClick:function(){if(kt.File){var e=new FormData;e.append("file",kt.File);var t=("PR_"+l.a.v4()+"."+/(?:\.([^.]+))?$/.exec(kt.File.name)[1]).replaceAll(/\s/g,"");R.a.post("/api/upload/attachment",e,{params:{Folder:"PR",FileName:t}}).then((function(e){var a=e.data.filePath,n=(new Date).toLocaleDateString(),i={FileName:t,FilePath:a,FileUploadedUser:Aa,FileUploadedDate:n,Remarks:Jt.AttachGroup.Remarks,Attach:Jt.AttachGroup.Attach},o=Object(r.a)(Vt.PurchaseRequisitionAttachmentsAddGrid);o.push(i),Qt({PurchaseRequisitionAttachmentsAddGrid:o,attachmentArray:{}}),$t({AttachGroup:{}}),document.getElementById("fileInput").value="",Gt({})})).catch((function(e){console.log(e)}))}},disabled:sa},"Add")),s.a.createElement("br",null),s.a.createElement(y.k,{id:"Items",allowColumnReordering:!0,showBorders:!0,dataSource:Vt.PurchaseRequisitionAttachmentsAddGrid,columnAutoWidth:!0,hoverStateEnabled:!0,onCellDblClick:function(e){return(I=I||Object(i.a)(P().mark((function e(t){var a,r,n,i,o,c,s,u;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.data.FileName),!t.data.FileName){e.next=10;break}return e.next=4,R.a.get("/api/viewFile",{responseType:"arraybuffer",params:{FilePath:t.data.FilePath},headers:{"Content-Type":"multipart/form-data"}});case 4:a=e.sent,n="",void 0!==a.config.params.FilePath&&(r=a.config.params.FilePath,i=r.split("\\"),o=i.pop(),c=o.split(".").pop().toLowerCase(),n=Pr(c)),null===a.data&&void 0===a.data||(s=new Blob([a.data],{type:n}),u=URL.createObjectURL(s),window.open(u,"_blank")),e.next=11;break;case 10:console.log("No file path available");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},s.a.createElement(y.b,{mode:"row",allowDeleting:!0}),s.a.createElement(y.a,{dataField:"FileName"}),s.a.createElement(y.a,{dataField:"FilePath"}),s.a.createElement(y.a,{dataField:"FileUploadedUser"}),s.a.createElement(y.a,{dataField:"FileUploadedDate",dataType:"date"}),s.a.createElement(y.a,{dataField:"Attach",editorType:"dxCheckBox"}),s.a.createElement(y.a,{dataField:"Remarks"}))),s.a.createElement(d.f,{eventKey:"Notes",title:"Notes"},s.a.createElement(d.g,{formData:Ya.PurchaseRequisitionHeader},s.a.createElement(d.b,{caption:"Notes",colCount:2},s.a.createElement(d.c,{dataField:"Note1"},s.a.createElement(d.d,{text:"Note 1"})),s.a.createElement(d.c,{dataField:"Note2"},s.a.createElement(d.d,{text:"Note 2"})),s.a.createElement(d.c,{dataField:"Note3"},s.a.createElement(d.d,{text:"Note 3"})),s.a.createElement(d.c,{dataField:"Note4"},s.a.createElement(d.d,{text:"Note 4"})),s.a.createElement(d.c,{dataField:"Note5"},s.a.createElement(d.d,{text:"Note 5"}))))),s.a.createElement(d.f,{eventKey:"Approval",title:"Approve"},s.a.createElement(d.g,{formData:Ya.PurchaseRequisitionHeader},s.a.createElement(d.b,{caption:"Approval Status"},s.a.createElement(d.c,{dataField:"ApproveStatus",editorType:"dxRadioGroup",editorOptions:{items:Ya.Status,valueExpr:"ID",displayExpr:"Name",layout:"horizontal",value:U,onValueChanged:function(e){return k(e.value)},readOnly:Rt}},s.a.createElement(d.d,{text:"Status"})),s.a.createElement(d.c,{dataField:"IsSapPost",editorType:"dxRadioGroup",editorOptions:{items:Ya.sapPost,valueExpr:"ID",displayExpr:"Name",layout:"horizontal",readOnly:!0}},s.a.createElement(d.d,{text:"SAP Post"}))),s.a.createElement(d.b,{caption:"Details"},s.a.createElement(d.c,{dataField:"ApproveLevel",visible:"2"===U,editorType:"dxSelectBox",editorOptions:{items:Z,valueExpr:"ApprovalLevel",displayExpr:"ApprovalLevel",onValueChanged:function(e){return(A=A||Object(i.a)(P().mark((function e(t){var a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0==t.value){e.next=5;break}return e.next=3,R.a.get("/api/getApprovalLevelName",{params:{ApprovalLevel:t.value,TransactionType:Ya.PurchaseRequisitionHeader.PRType}});case 3:0!=(a=e.sent).data.length&&za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApprovalDescription:a.data.ApprovalLevelName})}}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}},s.a.createElement(d.e,{message:"Field required"}),s.a.createElement(d.d,{text:"Approval Level"})),s.a.createElement(d.c,{dataField:"Remark",visible:"2"!==U},s.a.createElement(d.d,{text:"Remarks"})),s.a.createElement(d.c,{dataField:"Date",editorType:"dxDateBox",visible:"2"!==U,editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Date"})),s.a.createElement(d.c,{dataField:"PRUser",visible:"2"!==U,editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"User"})),s.a.createElement(d.c,{dataField:"ApprovalDescription",visible:"2"===U,editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Approval Description"})),s.a.createElement(d.c,{dataField:"ApproveRemarks",visible:"2"===U},s.a.createElement(d.d,{text:"Approval Remarks"})),s.a.createElement(d.c,{dataField:"ApproveDate",editorType:"dxDateBox",visible:"2"===U,editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Approval Date"})),s.a.createElement(d.c,{dataField:"ApproveUser",visible:"2"===U,editorOptions:{readOnly:!0}},s.a.createElement(d.d,{text:"Approval User"}))))))),s.a.createElement("br",null),s.a.createElement(p.a,{title:"Summary"},s.a.createElement(d.g,{formData:Ya.PurchaseRequisitionHeader},s.a.createElement(d.b,{caption:"Summary",colCount:2},s.a.createElement(d.c,{dataField:"TotalAmount",editorType:"dxNumberBox",editorOptions:{maxLength:50,format:"#,##0.00",readOnly:!0},format:"#,##0.00"},s.a.createElement(d.d,{text:"Total Amount"})),s.a.createElement(d.c,{dataField:"TotalCost",editorType:"dxNumberBox",editorOptions:{readOnly:!0,format:"#,##0.00"},format:"#,##0.00"},s.a.createElement(d.d,{text:"Total Cost"})))),s.a.createElement("br",null),s.a.createElement(h.a,{bg:"light",variant:"light"},s.a.createElement(f.a,{variant:"secondary",icon:"feather icon-layers",onClick:function(e){return(O=O||Object(i.a)(P().mark((function e(t){var a,r,n,o,c,s,u,l,d,p,m;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,br();case 2:if(!e.sent){e.next=42;break}return a="",r=0,c=0,s=!1,u=!1,ta(!1),e.next=11,R.a.get("/api/getUserGroup",{params:{UserName:Aa}});case 11:if(0!=(l=e.sent).data.length&&(a=l.data[0].UserGroup),void 0==Ya.PurchaseRequisitionHeader.ApproveLevel){e.next=41;break}return e.next=16,R.a.get("/api/getfinalLevel",{params:{ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel,TransactionType:Ya.PurchaseRequisitionHeader.PRType}});case 16:return 0!=(d=e.sent).data.length&&d.data[0].FinalLevel&&2==Ya.PurchaseRequisitionHeader.ApproveStatus&&(r=2),e.next=20,R.a.get("/api/getUserGroup",{params:{UserName:Aa}});case 20:if(0==(p=e.sent).data.length){e.next=25;break}return e.next=24,R.a.get("/api/getApprovalLevelDetails",{params:{UserGroup:p.data[0].UserGroup,ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel}});case 24:n=e.sent;case 25:if(0==n.data.length){e.next=41;break}return e.next=28,R.a.get("/api/getfinalLevel",{params:{ApprovalLevel:Ya.PurchaseRequisitionHeader.ApproveLevel,TransactionType:Ya.PurchaseRequisitionHeader.PRType}});case 28:if(0==(o=e.sent).data.length){e.next=41;break}if(s=o.data[0].FinalLevel,c=o.data[0].Priority,!o.data[0].FinalLevel||2!=Ya.PurchaseRequisitionHeader.ApproveStatus){e.next=41;break}return e.next=35,Ct(!0);case 35:if(u=!0,void 0!=Ya.PurchaseRequisitionHeader.PRNumber){e.next=41;break}return e.next=39,R.a.get("/api/number-series-lookup-by-module",{params:{DocumentID:3e3}});case 39:m=e.sent,Ma=m.data[0].Series;case 41:ba||R.a.post("/api/addPurchesRequest",{PurchaseRequisitionHeader:JSON.stringify(Ya.PurchaseRequisitionHeader),PurchaseRequisitionItems:JSON.stringify(Ga.PurchaseRequisitionItems),PurchaseRequisitionAttachments:JSON.stringify(Vt.PurchaseRequisitionAttachmentsAddGrid),UserGroup:a,PRHeaderID:vt,finalStatus:r,IsFinal:s,Priority:c,IsSapPost:u,UserID:Aa}).then((function(e){var t;console.log(e.data),v.a.fire({icon:"success",title:"Success",text:"Saved Successfully!"}).then((function(e){return(t=t||Object(i.a)(P().mark((function e(t){var a,r,n;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.a.get("/api/getAllPR",{params:{EnterUser:Aa}});case 2:a=e.sent,console.log("getfinalLevel",o),Oe(a.data),void 0!=Ya.PurchaseRequisitionHeader.ApproveLevel&&0!=Ya.PurchaseRequisitionHeader.ApproveLevel&&void 0!=o?0!=o.data.length&&(r=o.data[0].FinalLevel,n=Ya.PurchaseRequisitionHeader.ApproveStatus,r&&2==n?yr():hr()):hr();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}))})).catch((function(e){console.error("Error:",e),v.a.fire({icon:"error",title:'<span style="color: red;">Error!</span>',text:"Failed to save purchase request details",confirmButtonColor:"#d33",confirmButtonText:"OK"})}));case 42:case"end":return e.stop()}}),e)})))).apply(this,arguments)},disabled:sa},"Save"),s.a.createElement(f.a,{variant:"secondary",icon:"feather icon-layers",onClick:hr},"Clear"))),s.a.createElement(p.a,{title:"PR List"},s.a.createElement(y.k,{dataSource:Pe,showBorders:!0,wordWrapEnabled:!0,allowSearch:!0,selection:{mode:"single"},hoverStateEnabled:!0,onCellDblClick:function(e){return(D=D||Object(i.a)(P().mark((function e(t){var a,r,i,o,c,s,u,l,d,p;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(pa){e.next=40;break}return Ht(!1),ta(!1),e.next=5,R.a.get("/api/getPRHeaders",{params:{PRNumber:t.data.PRNumber}});case 5:return a=e.sent,e.next=8,R.a.get("/api/getPRItems",{params:{PRHeaderID:t.data.PRHeaderID}});case 8:return r=e.sent,e.next=11,R.a.get("/api/getPRAttachment",{params:{PRHeaderID:t.data.PRHeaderID}});case 11:return i=e.sent,e.next=14,R.a.get("/api/getPMOfficer");case 14:if(o=e.sent,rt(o.data),Ee(t.data.rowIndex),xt(t.data.PRHeaderID),Qt({PurchaseRequisitionAttachmentsAddGrid:i.data}),za({PurchaseRequisitionHeader:a.data[0]}),void 0!=t.data.ValidTo&&void 0!=t.data.ApproveStatus&&(c=gr(new Date(t.data.ValidTo)),s=gr(new Date),c<s&&0==t.data.ApproveStatus&&za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ValidityStatus:0})}}))),u=r.data,l=u.map((function(e){return e.TotalAmountExclusive=e.Quantity*e.UnitPrice,e.TotalCostExclusive=e.Quantity*e.UnitCost,e})),La({PurchaseRequisitionItems:l}),void 0==t.data.ApproveStatus&&2!=t.data.ApproveStatus){e.next=35;break}return e.next=27,R.a.get("/api/getUserGroup",{params:{UserName:Aa}});case 27:if(0==(d=e.sent).data.length){e.next=32;break}return e.next=31,R.a.get("/api/getNextPriority",{params:{PRHeaderID:t.data.PRNumber,UserGroup:d.data[0].UserGroup}});case 31:p=e.sent;case 32:0!=p.data.length?(za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:"2"})}})),gt(!0),ua(!0)):4!=t.data.ApproveStatus&&0!=t.data.ApproveStatus&&2!=t.data.ApproveStatus?(ua(!0),gt(!0),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:t.data.ApproveStatus})}}))):(ua(!1),gt(!1),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:t.data.ApproveStatus})}}))),e.next=38;break;case 35:ua(!1),gt(!1),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{ApproveStatus:t.data.ApproveStatus})}}));case 38:setTimeout((function(){Rr()}),200),za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{FileNo:t.data.FileNo,LastFileName:t.data.LastFileName})}}));case 40:za((function(e){return{PurchaseRequisitionHeader:Object(n.a)(Object(n.a)({},e.PurchaseRequisitionHeader),{},{PRUser:Aa,ApproveUser:Aa})}}));case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)},allowColumnResizing:!0,columnAutoWidth:!0},s.a.createElement(y.j,{visible:!0}),s.a.createElement(y.h,{defaultPageSize:20}),s.a.createElement(y.a,{dataField:"PRHeaderID",visible:!1}),s.a.createElement(y.a,{dataField:"PRType",caption:"PR Type"},s.a.createElement(y.g,{items:B,valueExpr:"PRTypeCode",displayExpr:"Discription"})),s.a.createElement(y.a,{dataField:"ItemCategory",caption:"Item Type"}),s.a.createElement(y.a,{dataField:"PRNumber",caption:"PR Number"}),s.a.createElement(y.a,{dataField:"CreatedDate",editorType:"dxDateBox",caption:"Created Date",format:"dd/MM/yyyy",customizeText:function(e){var t=new Date(e.value);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear())}}),s.a.createElement(y.a,{dataField:"ExpectedDate",editorType:"dxDateBox",caption:"Created Date",format:"dd/MM/yyyy",customizeText:function(e){var t=new Date(e.value);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear())}}),s.a.createElement(y.a,{dataField:"ProcurementOfficer",caption:"Procurement Officer"}),s.a.createElement(y.a,{dataField:"FileNo",caption:"File No"}),s.a.createElement(y.a,{dataField:"LastFileName",caption:"File Name"}),s.a.createElement(y.a,{dataField:"ValidityStatus",caption:"Validity Status"},s.a.createElement(y.g,{items:nr.validStatus,valueExpr:"ID",displayExpr:"Name"})),s.a.createElement(y.a,{dataField:"ValidTo",editorType:"dxDateBox",caption:"Valid To",format:"dd/MM/yyyy",customizeText:function(e){var t=new Date(e.value);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear())}}),s.a.createElement(y.a,{dataField:"RequestorName",caption:"Requestor Name"}),s.a.createElement(y.a,{dataField:"RequestorsBranch",caption:"Requestors Branch"},s.a.createElement(y.g,{items:Xe,valueExpr:"BranchCode",displayExpr:"Discription"})),s.a.createElement(y.a,{dataField:"ApproveStatus",caption:"Approve Status"},s.a.createElement(y.g,{items:Xa.Status,valueExpr:"ID",displayExpr:"Name"})),s.a.createElement(y.a,{dataField:"IsSapPost",caption:"SAP Post"},s.a.createElement(y.g,{items:tr.Status,valueExpr:"ID",displayExpr:"Name"})),s.a.createElement(y.a,{dataField:"ApproveLevel",caption:"Approve Level"}),s.a.createElement(y.a,{dataField:"ApproveUser",caption:"Approval status Change User"}),s.a.createElement(y.a,{dataField:"ApproveDate",editorType:"dxDateBox",caption:"Approve Date",format:"dd/MM/yyyy",customizeText:function(e){var t=new Date(e.value);return"".concat(t.getDate(),"/").concat(t.getMonth()+1,"/").concat(t.getFullYear())}}))))}}}]);
//# sourceMappingURL=49.8f816ce4.chunk.js.map